// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Barn {
  id         String   @id @default(cuid())
  name       String
  inviteCode String   @unique
  createdAt  DateTime @default(now()) @db.Timestamptz(3)
  riders     Rider[]
  horses     Horse[]
}

model Horse {
  id                 String    @id @default(cuid())
  name               String
  notes              String?
  isActive           Boolean   @default(true)
  createdAt          DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt          DateTime  @updatedAt @db.Timestamptz(3)
  sessions           Session[]
  summaryContent     String?
  summaryGeneratedAt DateTime? @db.Timestamptz(3)
  barnId             String
  barn               Barn      @relation(fields: [barnId], references: [id])

  @@index([barnId])
}

enum RiderRole {
  RIDER
  TRAINER
}

model Rider {
  id        String    @id @default(cuid())
  name      String
  email     String    @unique
  role      RiderRole @default(RIDER)
  createdAt DateTime  @default(now()) @db.Timestamptz(3)
  password  String
  sessions  Session[]
  barnId    String
  barn      Barn      @relation(fields: [barnId], references: [id])

  @@index([barnId])
}

model Session {
  id              String   @id @default(cuid())
  horse           Horse    @relation(fields: [horseId], references: [id])
  horseId         String
  rider           Rider    @relation(fields: [riderId], references: [id])
  riderId         String
  date            DateTime @db.Timestamptz(3)
  durationMinutes Int
  workType        WorkType
  intensity       Intensity?
  rating          Int?
  notes           String   @default("")
  createdAt       DateTime @default(now()) @db.Timestamptz(3)
  updatedAt       DateTime @updatedAt @db.Timestamptz(3)
}


enum WorkType {
  FLATWORK
  JUMPING
  GROUNDWORK
  IN_HAND
  TRAIL
  OTHER
}

enum Intensity {
  LIGHT
  MODERATE
  HARD
  VERY_HARD
}
